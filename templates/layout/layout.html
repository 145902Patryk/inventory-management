{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
  <style>
      .dot {
          position: absolute;
          background: red;
          border-radius: 50%;
          transform: translate(-50%, -50%);
          z-index: 100;
          border: solid 2px;
      }

      #image_preview {
          position: relative;
      }

      #image_preview img {
          cursor: crosshair;
      }
  </style>
{% endblock extra_css %}
{% block content %}
  <div class="container">
    <div class="row">
      {% for layout in object_list %}
        <div class="col-md-8">
          <div id="image_preview{{ layout.pk }}">
            <img src="{{ layout.image.url }}">
          </div>
        </div>
        <div class="col-md-4">{{ layout.name }}</div>
      {% endfor %}
    </div>
  </div>
{% endblock content %}
{% block extra_js %}
  <script>
      let dots = {{ js_obj|safe }};
      $('img').on('dragstart', (event) => {
          event.preventDefault();
      });
      $(document).on('click', '.dot', (ev) => {
          console.log('dot click')
          const dot = $(ev.currentTarget)
          console.log(dot.css('top'))
      })
      $('#image_preview img').on('click', (ev) => {
          console.log('click')
          const o = $(ev.currentTarget).offset()
          const y = ev.pageY - o.top
          const x = ev.pageX - o.left
          console.log(x, y)
          const dot = $('<div />', {
              'class': 'dot',
              css: {
                  top: y,
                  left: x,
                  width: 20,
                  height: 20,
              },
          });
          console.log(dot)
          $('#image_preview').append(dot)
      });
      $(document).ready(() => {
          for (const [key, value] of Object.entries(dots)) {
              value.forEach((el) => {
                  $('<div />', {
                      'class': 'dot',
                      css: {
                          top: el.y,
                          left: el.x,
                          width: 20,
                          height: 20,
                      },
                      appendTo: $(`#${key}`)
                  });
              })
          }

      })
  </script>
{% endblock extra_js %}